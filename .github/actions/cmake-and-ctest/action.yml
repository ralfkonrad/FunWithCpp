name:
  cmake-and-ctest
description:
  Builds the project and tests it using cmake and ctest

inputs:
  os:
    description: The os for the run.
    required: true

  cc:
    description: The c compiler to use.
    required: true

  cxx:
    description: The c++ compiler to use.
    required: true

  cxx-standard:
    description: The c++ standard used with the run.
    required: true

runs:
  using: composite
  steps:
    - name: Setup needed software
      id: setup
      uses: ./.github/actions/setup
      with:
        os: ${{ inputs.os }}
        cxx: ${{ inputs.cxx }}

    - name: Configure CMake and Build
      env:
        CC: ${{ inputs.cc }}
        CXX: ${{ inputs.cxx }}
        CMAKE_CONFIG_TYPE: Release
        CMAKE_GENERATOR: Ninja
        CMAKE_CXX_COMPILER_LAUNCHER: ${{ steps.setup.outputs.ccache-variant }}
      shell: bash
      run: |
        cmake --version
        cmake -S . -B ./build -DRKE_COMPILE_WARNING_AS_ERROR=ON -DCMAKE_CXX_STANDARD=${{ inputs.cxx-standard }} -L
        cmake --build ./build -v

    - name: Test
      env:
        CMAKE_CONFIG_TYPE: Release
      working-directory: ./build
      shell: bash
      run: |
        ctest --extra-verbose
